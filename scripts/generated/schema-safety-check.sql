-- Generated by agent-schema-migration-assistant.js
-- Human approval required. Do not auto-run in production.
-- Purpose: run BEFORE and AFTER migration to validate schema shape and row counts.


-- Table: account_activities
SELECT
  'account_activities' AS table_name,
  CASE WHEN to_regclass('public.account_activities') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'account_activities'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'account_activities'
ORDER BY ordinal_position;


-- Table: agent_run_findings
SELECT
  'agent_run_findings' AS table_name,
  CASE WHEN to_regclass('public.agent_run_findings') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'agent_run_findings'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'agent_run_findings'
ORDER BY ordinal_position;


-- Table: agent_runs
SELECT
  'agent_runs' AS table_name,
  CASE WHEN to_regclass('public.agent_runs') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'agent_runs'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'agent_runs'
ORDER BY ordinal_position;


-- Table: app_error_events
SELECT
  'app_error_events' AS table_name,
  CASE WHEN to_regclass('public.app_error_events') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'app_error_events'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'app_error_events'
ORDER BY ordinal_position;


-- Table: current_inventory
SELECT
  'current_inventory' AS table_name,
  CASE WHEN to_regclass('public.current_inventory') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'current_inventory'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'current_inventory'
ORDER BY ordinal_position;


-- Table: data_integrity_exceptions
SELECT
  'data_integrity_exceptions' AS table_name,
  CASE WHEN to_regclass('public.data_integrity_exceptions') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'data_integrity_exceptions'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'data_integrity_exceptions'
ORDER BY ordinal_position;


-- Table: dispatch_records
SELECT
  'dispatch_records' AS table_name,
  CASE WHEN to_regclass('public.dispatch_records') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'dispatch_records'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'dispatch_records'
ORDER BY ordinal_position;


-- Table: expense_transactions
SELECT
  'expense_transactions' AS table_name,
  CASE WHEN to_regclass('public.expense_transactions') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'expense_transactions'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'expense_transactions'
ORDER BY ordinal_position;


-- Table: hf_arabica
SELECT
  'hf_arabica' AS table_name,
  CASE WHEN to_regclass('public.hf_arabica') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'hf_arabica'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'hf_arabica'
ORDER BY ordinal_position;


-- Table: hf_pepper
SELECT
  'hf_pepper' AS table_name,
  CASE WHEN to_regclass('public.hf_pepper') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'hf_pepper'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'hf_pepper'
ORDER BY ordinal_position;


-- Table: hf_robusta
SELECT
  'hf_robusta' AS table_name,
  CASE WHEN to_regclass('public.hf_robusta') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'hf_robusta'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'hf_robusta'
ORDER BY ordinal_position;


-- Table: inventory_summary
SELECT
  'inventory_summary' AS table_name,
  CASE WHEN to_regclass('public.inventory_summary') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'inventory_summary'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'inventory_summary'
ORDER BY ordinal_position;


-- Table: labor_transactions
SELECT
  'labor_transactions' AS table_name,
  CASE WHEN to_regclass('public.labor_transactions') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'labor_transactions'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'labor_transactions'
ORDER BY ordinal_position;


-- Table: mv_pepper
SELECT
  'mv_pepper' AS table_name,
  CASE WHEN to_regclass('public.mv_pepper') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'mv_pepper'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'mv_pepper'
ORDER BY ordinal_position;


-- Table: mv_robusta
SELECT
  'mv_robusta' AS table_name,
  CASE WHEN to_regclass('public.mv_robusta') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'mv_robusta'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'mv_robusta'
ORDER BY ordinal_position;


-- Table: pg_pepper
SELECT
  'pg_pepper' AS table_name,
  CASE WHEN to_regclass('public.pg_pepper') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'pg_pepper'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'pg_pepper'
ORDER BY ordinal_position;


-- Table: pg_robusta
SELECT
  'pg_robusta' AS table_name,
  CASE WHEN to_regclass('public.pg_robusta') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'pg_robusta'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'pg_robusta'
ORDER BY ordinal_position;


-- Table: processing_records
SELECT
  'processing_records' AS table_name,
  CASE WHEN to_regclass('public.processing_records') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'processing_records'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'processing_records'
ORDER BY ordinal_position;


-- Table: rainfall_records
SELECT
  'rainfall_records' AS table_name,
  CASE WHEN to_regclass('public.rainfall_records') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'rainfall_records'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'rainfall_records'
ORDER BY ordinal_position;


-- Table: sales_records
SELECT
  'sales_records' AS table_name,
  CASE WHEN to_regclass('public.sales_records') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'sales_records'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'sales_records'
ORDER BY ordinal_position;


-- Table: tenant_modules
SELECT
  'tenant_modules' AS table_name,
  CASE WHEN to_regclass('public.tenant_modules') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'tenant_modules'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'tenant_modules'
ORDER BY ordinal_position;


-- Table: tenants
SELECT
  'tenants' AS table_name,
  CASE WHEN to_regclass('public.tenants') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'tenants'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'tenants'
ORDER BY ordinal_position;


-- Table: transaction_history
SELECT
  'transaction_history' AS table_name,
  CASE WHEN to_regclass('public.transaction_history') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'transaction_history'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'transaction_history'
ORDER BY ordinal_position;


-- Table: user_modules
SELECT
  'user_modules' AS table_name,
  CASE WHEN to_regclass('public.user_modules') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'user_modules'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'user_modules'
ORDER BY ordinal_position;


-- Table: users
SELECT
  'users' AS table_name,
  CASE WHEN to_regclass('public.users') IS NULL THEN false ELSE true END AS table_exists,
  COALESCE(
    (
      SELECT c.reltuples::bigint
      FROM pg_class c
      JOIN pg_namespace n ON n.oid = c.relnamespace
      WHERE n.nspname = 'public'
        AND c.relname = 'users'
        AND c.relkind IN ('r', 'p')
      LIMIT 1
    ),
    0
  ) AS estimated_rows;
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_schema = 'public'
  AND table_name = 'users'
ORDER BY ordinal_position;

